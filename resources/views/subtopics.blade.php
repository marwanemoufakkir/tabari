<!DOCTYPE html>
<html direction="rtl" dir="rtl" style="direction: rtl">
	<!--begin::Head-->
	    <head><base href="../../">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta charset="utf-8" />
		<!--begin::Fonts-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
		<!--end::Fonts-->
		<!--begin::Global Stylesheets Bundle(used by all pages)-->
		<link href="assets/plugins/global/plugins.bundle.rtl.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/style.bundle.rtl.css" rel="stylesheet" type="text/css" />
		<!--end::Global Stylesheets Bundle-->
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_body" class="header-fixed header-tablet-and-mobile-fixed aside-enabled">
		<!--begin::Main-->
		<!--begin::Root-->
		<div class="d-flex flex-column flex-root">
			<!--begin::Page-->
			<div class="page d-flex flex-column flex-column-fluid">
				<!--begin::Header-->
				<div id="kt_header" class="header align-items-stretch">
					<!--begin::Container-->
					<div class="container-xxl d-flex align-items-stretch justify-content-between">
						<!--begin::Brand-->
						<div class="d-flex align-items-center flex-grow-1 flex-lg-grow-0 w-lg-225px me-5">
							<!--begin::Aside mobile toggle-->
							<div class="btn btn-icon btn-active-icon-primary ms-n2 me-2 d-flex d-lg-none" id="kt_aside_toggle">
								<!--begin::Svg Icon | path: icons/duotune/abstract/abs015.svg-->
								<span class="svg-icon svg-icon-1">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
										<path d="M21 7H3C2.4 7 2 6.6 2 6V4C2 3.4 2.4 3 3 3H21C21.6 3 22 3.4 22 4V6C22 6.6 21.6 7 21 7Z" fill="black" />
										<path opacity="0.3" d="M21 14H3C2.4 14 2 13.6 2 13V11C2 10.4 2.4 10 3 10H21C21.6 10 22 10.4 22 11V13C22 13.6 21.6 14 21 14ZM22 20V18C22 17.4 21.6 17 21 17H3C2.4 17 2 17.4 2 18V20C2 20.6 2.4 21 3 21H21C21.6 21 22 20.6 22 20Z" fill="black" />
									</svg>
								</span>
								<!--end::Svg Icon-->
							</div>
							<!--end::Aside mobile toggle-->
                        <!--begin::Logo-->
                        <a href="../../demo5/dist/index.html">
                            <img alt="Logo" src="assets/media/logos/LOGO-x76x53.png" class="d-none d-lg-inline h-50px" />
                            <img alt="Logo" src="assets/media/logos/LOGO-x76x53.png" class="d-lg-none h-40px" />
                        </a>
                        <!--end::Logo-->
						</div>
						<!--end::Brand-->
						<!--begin::Wrapper-->
                        <div class="d-flex align-items-stretch justify-content-between flex-lg-grow-1">
							<!--begin::Navbar-->
							<div class="d-flex align-items-stretch" id="kt_header_nav">
								<!--begin::Menu wrapper-->
								<div class="header-menu align-items-stretch" data-kt-drawer="true" data-kt-drawer-name="header-menu" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="{default:'200px', '300px': '250px'}" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_header_menu_mobile_toggle" data-kt-swapper="true" data-kt-swapper-mode="prepend" data-kt-swapper-parent="{default: '#kt_body', lg: '#kt_header_nav'}">
									<!--begin::Menu-->
									<div class="menu menu-lg-rounded menu-column menu-lg-row menu-state-bg menu-title-gray-700 menu-state-title-primary menu-state-icon-primary menu-state-bullet-primary menu-arrow-gray-400 fw-bold my-5 my-lg-0 align-items-stretch" id="#kt_header_menu" data-kt-menu="true">
										<div class="menu-item me-lg-1">
											<a class="menu-link   active py-3" href="/topics?surah=&chart=packedbubble">
												<span class="text-dark fw-bolder">Graph</span>
											</a>
										</div>
                                        <div class="menu-item me-lg-1">
											<a class="menu-link   py-3" href="{{'/search'}}">
												<span class="text-dark fw-bolder">Search</span>
											</a>
										</div>
                                        <div class="menu-item me-lg-1">
											<a class="menu-link  py-3" href="#">
												<span class="text-dark fw-bolder">About</span>
											</a>
										</div>
									</div>
									<!--end::Menu-->
								</div>
								<!--end::Menu wrapper-->
							</div>
							<!--end::Navbar-->

						</div>
						<!--end::Wrapper-->
					</div>
					<!--end::Container-->
				</div>
				<!--end::Header-->
				<!--begin::Container-->
				<div id="kt_content_container" class="d-flex flex-column-fluid align-items-stretch container-xxl">
					<!--begin::Aside-->
					<div id="kt_aside" class="aside" data-kt-drawer="true" data-kt-drawer-name="aside" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="{default:'200px', '300px': '225px'}" data-kt-drawer-direction="start" data-kt-drawer-toggle="#kt_aside_toggle" data-kt-sticky="true" data-kt-sticky-name="aside-sticky" data-kt-sticky-offset="{default: false, lg: '1px'}" data-kt-sticky-width="{lg: '225px'}" data-kt-sticky-left="auto" data-kt-sticky-top="94px" data-kt-sticky-animation="false" data-kt-sticky-zindex="95">
						<!--begin::Aside nav-->
						<div class="hover-scroll-overlay-y my-5 my-lg-5 w-100 ps-4 ps-lg-0 pe-4 me-1" id="kt_aside_menu_wrapper" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_header" data-kt-scroll-wrappers="#kt_aside" data-kt-scroll-offset="5px">
							<!--begin::Menu-->
							<div class="menu menu-column menu-active-bg menu-hover-bg menu-title-gray-700 fs-6 menu-rounded w-100" id="#kt_aside_menu" data-kt-menu="true">
                                <!--begin::Heading-->
                                <div class="menu-item">
                                    <div class="menu-content pb-2">
                                        <span class="menu-section text-muted text-uppercase fs-7 fw-bolder">Dashboard MENU</span>
                                    </div>
                                </div>
                                <!--end::Heading-->
                                <!--begin::Menu item-->
								<div class="menu-item">
									<a href="/topics?surah=&chart=packedbubble" class="menu-link ">
										<span class="menu-title">Topics</span>
										
									</a>
								</div>
								<!--end::Menu item-->
								<!--begin::Menu item-->
								<div class="menu-item">
									<a href="/subtopics?surah=&chart=packedbubble" class="menu-link active" >
										<span class="menu-title">Subtopics</span>
										
									</a>
								</div>
								<!--end::Menu item-->
								<!--begin::Menu item-->
								<div class="menu-item">
									<a href="/rawi?surah=&chart=packedbubble" class="menu-link">
										<span class="menu-title">Rawi</span>
										
									</a>
								</div>
								<!--end::Menu item-->
								<!--begin::Menu item-->
								<div class="menu-item">
									<a href="/location?surah=&chart=packedbubble" class="menu-link">
										<span class="menu-title">Location</span>
										
									</a>
								</div>
								<!--end::Menu item-->
                                    <!--end::Input group-->
								<!--end::Heading-->
                                <!--begin::Heading-->
								<div class="menu-item pt-5">
									<div class="menu-content pb-2">
										<span class="menu-section text-muted text-uppercase fs-7 fw-bolder">Filter Option</span>
									</div>
								</div>
                                <form id="topicForm">
                                    <div class="mb-5">
                                        <label class="fs-6 form-label fw-bolder text-dark">  Surah</label>
                                        <select id="surah" class="form-select form-select-solid" data-kt-select2="true" data-placeholder="سورة  Surah" data-allow-clear="true" name="surah">
                                            <option></option>
                                            @foreach (\App\Models\Surah::get() as $surah)
                                            <option value="{{ $surah->id}}">{!! str_replace('سورة', ' ', $surah->title) !!} - {{ $surah->transliteration }}</option>
                                            @endforeach
                                            
                                        </select>
                                    </div>
                                    <div class="mb-5">
                                        <label class="fs-6 form-label fw-bolder text-dark">  Type chart</label>
                                        <select class="form-select form-select-solid" data-kt-select2="true" data-placeholder="select chart" data-allow-clear="true" name="chart">
                                            
                                            <option value="packedbubble" selected>Bubble</option>
                                            <option value="pie">Pie chart</option>
                                        </select>
                                    </div>
                                    <div class="mb-5">
                                    <!--begin::Action-->
                                    <div class="d-flex align-items-left justify-content-start">
                                        <button type="reset" class="btn btn-active-light-primary btn-color-gray-400 me-3">Discard</button>
                                        <button type="submit" class="btn btn-warning fw-bolder btn-text-dark">Filter</button>
                                    </div>
                                    <!--end::Action-->
                                    </div>
                                </form>
								<!--end::Heading-->
							</div>
							<!--end::Menu-->
						</div>
						<!--end::Aside nav-->
					</div>
					<!--end::Aside-->
					<!--begin::Wrapper-->
					<div class="wrapper d-flex flex-column flex-row-fluid mt-5 mt-lg-10" id="kt_wrapper">
						<!--begin::Content-->
						<div class="content flex-column-fluid" id="kt_content">
							<!--begin::Toolbar-->
							<div class="toolbar d-flex flex-stack flex-wrap mb-5 mb-lg-7" id="kt_toolbar">
								<!--begin::Page title-->
								<div class="page-title d-flex flex-column py-1">
									<!--begin::Title-->
									<h1 class="d-flex align-items-center my-1">
										<span class="text-dark fw-bolder fs-1">Dashboard</span>
									</h1>
									<!--end::Title-->
									<!--begin::Breadcrumb-->
									<ul class="breadcrumb breadcrumb-separatorless fw-bold fs-7 my-1">
										<!--begin::Item-->
										<li class="breadcrumb-item text-muted">
											<a href="../../demo5/dist/index.html" class="text-muted text-hover-primary">Dashboard</a>
										</li>
										<!--end::Item-->
										<!--begin::Item-->
										<li class="breadcrumb-item">
											<span class="bullet bg-gray-200 w-5px h-2px"></span>
										</li>
										<!--begin::Item-->
										<li class="breadcrumb-item text-dark">SubTopics</li>
										<!--end::Item-->
									</ul>
									<!--end::Breadcrumb-->
								</div>
								<!--end::Page title-->

							</div>
							<!--end::Toolbar-->
							<!--begin::Post-->
							<div class="post" id="kt_post">
								<!--begin::Row-->
								<div class="row g-5 g-xl-8">
									<div class="col-xl">
										<!--begin::Charts Widget 2-->
										<div class="card card-xl-stretch mb-5 mb-xl-8">
											<!--begin::Header-->
											<div class="card-header border-0 pt-5">
												<h3 class="card-title align-items-start flex-column">
													<span class="card-label fw-bolder fs-3 mb-1">Subtopics</span>
													<span class="text-muted fw-bold fs-7">مواضيع</span>
												</h3>

											</div>
											<!--end::Header-->
											<!--begin::Body-->
											<div class="card-body">
												<!--begin::Chart-->
												<div id="kt_charts_widget_2_chart" >
                                                    
                                                </div>
												<!--end::Chart-->
											</div>
											<!--end::Body-->
										</div>
										<!--end::Charts Widget 2-->
									</div>
								</div>
								<!--end::Row-->

							</div>
							<!--end::Post-->
						</div>
						<!--end::Content-->
						<div class="footer pt-10 pb-5 d-flex flex-column flex-md-row flex-stack" id="kt_footer" style="background-color: #757052;padding-left: 40px;padding-right: 40px;">
							<!--begin::Copyright-->
							<div class="text-dark order-2 order-md-1">
								<span class="text-white fw-semibold me-1">2022©</span>
							</div>
							<!--end::Copyright-->
							<!--begin::Menu-->
							<ul class="menu fw-semibold order-1">
								<li class="menu-item">
									<a href="/topics?surah=&amp;chart=packedbubble"  class="text-white  px-2">Graph</a>
								</li>
								<li class="menu-item">
									<a href="/search"  class="text-white  px-2">Search</a>
								</li>
								<li class="menu-item">
									<a href="/about"  class="text-white  ps-2 pe-0">About</a>
								</li>
							</ul>
							<!--end::Menu-->
						</div>
					</div>
					<!--end::Wrapper-->
				</div>
				<!--end::Container-->
			</div>
			<!--end::Page-->
		</div>
		<!--end::Root-->

		<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<!--begin::Svg Icon | path: icons/duotune/arrows/arr066.svg-->
			<span class="svg-icon">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
					<rect opacity="0.5" x="13" y="6" width="13" height="2" rx="1" transform="rotate(90 13 6)" fill="black" />
					<path d="M12.5657 8.56569L16.75 12.75C17.1642 13.1642 17.8358 13.1642 18.25 12.75C18.6642 12.3358 18.6642 11.6642 18.25 11.25L12.7071 5.70711C12.3166 5.31658 11.6834 5.31658 11.2929 5.70711L5.75 11.25C5.33579 11.6642 5.33579 12.3358 5.75 12.75C6.16421 13.1642 6.83579 13.1642 7.25 12.75L11.4343 8.56569C11.7467 8.25327 12.2533 8.25327 12.5657 8.56569Z" fill="black" />
				</svg>
			</span>
			<!--end::Svg Icon-->
		</div>
		<!--end::Scrolltop-->
		<!--end::Main-->
		<script>var hostUrl = "assets/";</script>
		<!--begin::Javascript-->
		<!--begin::Global Javascript Bundle(used by all pages)-->
		<script src="assets/plugins/global/plugins.bundle.js"></script>
		<script src="assets/js/scripts.bundle.js"></script>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/highcharts-more.js"></script>
        <script>

$(document).ready(function () {

	  var surah= '{{ request()->has("surah") ? request()->get("surah") : "" }}'
	  var chart= '{{ request()->has("chart") ? request()->get("chart") : "packedbubble" }}'

      var hadithData=[]; 
      var nothadithData=[]; 
	  var hadithDataPie=[]; 
      var nothadithDataPie=[]; 
        $.ajax({
        url: "{{url('dashboard/subtopicsBubble')}}",
        type: "GET",
		data: {
			surah: surah
		},
        dataType: 'json',
        success: function (result) {
        
        var hadith = result.data.hadith.buckets.type.subtopics.buckets;
        var nothadith = result.data.nothadith.buckets.type.subtopics.buckets;
            $.each(hadith, function (key, value) {
                var obj = { 
                    name: key,
                    value: value.doc_count
                };
				var objPie = { 
                    name: key,
                    y: value.doc_count
                };
                hadithData.push(obj);
				hadithDataPie.push(objPie)
            });
            $.each(nothadith, function (key, value) {
                var obj = { 
                    name: key,
                    value: value.doc_count
                };
				var objPie = { 
                    name: key,
                    y: value.doc_count
                };
                nothadithData.push(obj);
				nothadithDataPie.push(objPie)
            });
			if(chart == 'pie'){
				Highcharts.chart('kt_charts_widget_2_chart', {
				chart: {
					plotBackgroundColor: null,
					plotBorderWidth: null,
					plotShadow: false,
					type: 'pie'
				},
				title: {
                    text: 'Subtopics in the whole book'
                },
                subtitle: {
                    text: 'مواضيع في الكتاب كله'
                },
				tooltip: {
					pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
				},
				accessibility: {
					point: {
					valueSuffix: '%'
					}
				},
				labels: {
					items: [{
						html: 'Hadith',
						style: {
							left: '200px',
							top: '300px',
							color: (Highcharts.theme && Highcharts.theme.textColor) || 'black'
						}
					}, {
						html: 'Nothadith',
						style: {
							left: '700px',
							top: '300px',
							color: (Highcharts.theme && Highcharts.theme.textColor) || 'black',
							
						}
					}]
					},
					series: [{
					type: 'pie',
					name: 'Hadith',
					colorByPoint: true,
					data: hadithDataPie,
					center: [700, 80],
					size: '80%',
					showInLegend: false,
					dataLabels: {
						enabled: true
					}
				},{
					type: 'pie',
					name: 'Nothadith',
					colorByPoint: true,
					data: nothadithDataPie,
					center: [200, 80],
					size: '80%',
					showInLegend: false,
					dataLabels: {
						enabled: true
					}
				}]
				});

			}else{

				Highcharts.chart('kt_charts_widget_2_chart', {
                chart: {
                    type: 'packedbubble',
                    height: '80%'
                },
                title: {
                    text: 'Subtopics in the whole book'
                },
                subtitle: {
                    text: 'مواضيع في الكتاب كله'
                },
                legend: {
                    layout: 'vertical',
                    align: 'left',
                    verticalAlign: 'top',
                    x: 10,
                    y: 0,
                    floating: true,
                    backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                    borderWidth: 1,
                },
                tooltip: {
                    useHTML: true,
                    pointFormat: '<b>{point.name}:</b> {point.value}'
                },
                plotOptions: {
                    packedbubble: {
                    minSize: '20%',
                    maxSize: '100%',
                    zMin: 0,
                    zMax: 1000,
                    layoutAlgorithm: {
                        gravitationalConstant: 0.05,
                        splitSeries: true,
                        seriesInteraction: false,
                        dragBetweenSeries: false,
                        parentNodeLimit: true
                    },
                    dataLabels: {
                        enabled: true,
                        format: '{point.name}',
                        style: {
                        color: 'black',
                        textOutline: 'none',
                        fontWeight: 'normal'
                        }
                    }
                    }
                },
                series: [{
                    name: 'Nothadith',
                    color: 'rgba(119, 152, 191, .5)',
                    data: hadithData
                    
                }, {
                    name: 'Hadith',
                    color: 'rgba(223, 83, 83, .5)',
                    data: nothadithData
                }]
                });
			}

        }
    });


});
        </script>

	</body>
	<!--end::Body-->
</html>